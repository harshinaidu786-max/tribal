<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tribal Handicrafts Marketplace</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>Tribal Handicrafts Marketplace</h1>
  <p>Promoting Value-Added Handicrafts to Support Tribal Communities</p>
</header>

<div class="container">

  <!-- LOGIN SECTION -->
  <div id="login-section" class="login-box">
    <h2>Login</h2>
    <label>Username:</label>
    <input type="text" id="user" />

    <label>Password:</label>
    <input type="password" id="pass" />

    <button onclick="login()">Login</button>
  </div>

  <!-- PRODUCTS SECTION -->
  <div id="product-section" style="display:none;">
    <h2>Available Handicraft Products</h2>
    <div class="products" id="product-list">
      <!-- Products will be loaded from backend -->
    </div>

    <button onclick="viewCart()" style="margin-top:20px;">View Cart</button>
  </div>

  <!-- CART SECTION -->
  <div id="cart-section" style="display:none;">
    <h2>Your Cart</h2>
    <div id="cart-items"></div>
    <button onclick="showPayment()">Proceed to Payment</button>
  </div>

  <!-- PAYMENT SECTION -->
  <div id="payment-section" style="display:none;">
    <h2>Select Payment Method</h2>
    <label><input type="radio" name="pay" value="UPI"> UPI</label><br>
    <label><input type="radio" name="pay" value="Credit Card"> Credit Card</label><br>
    <label><input type="radio" name="pay" value="Debit Card"> Debit Card</label><br>
    <label><input type="radio" name="pay" value="Cash on Delivery"> Cash on Delivery</label><br>

    <button onclick="completePayment()">Pay Now</button>
  </div>

</div>

<script>
let cart = [];

// LOGIN (with backend)
function login() {
  let username = document.getElementById("user").value;
  let password = document.getElementById("pass").value;

  fetch("/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      document.getElementById("login-section").style.display = "none";
      document.getElementById("product-section").style.display = "block";
      loadProducts();
    } else {
      alert("Invalid username or password");
    }
  });
}

// FETCH PRODUCTS FROM BACKEND
function loadProducts() {
  fetch("/products")
    .then(res => res.json())
    .then(products => {
      let list = document.getElementById("product-list");
      list.innerHTML = "";
      products.forEach(p => {
        list.innerHTML += `
        <div class="product">
          <img src="${p.image}">
          <h3>${p.name}</h3>
          <p>${p.desc}</p>
          <strong>₹${p.price}</strong><br>
          <button onclick="addToCart('${p.name}', ${p.price})">Add to Cart</button>
        </div>
        `;
      });
    });
}

// ADD TO CART
function addToCart(name, price) {
  cart.push({ name, price });
  alert(name + " added to cart!");
}

// VIEW CART
function viewCart() {
  document.getElementById("product-section").style.display = "none";
  document.getElementById("cart-section").style.display = "block";

  let cartDiv = document.getElementById("cart-items");
  cartDiv.innerHTML = "";
  cart.forEach(item => {
    cartDiv.innerHTML += `<p>${item.name} - ₹${item.price}</p>`;
  });
}

// PAYMENT SECTION
function showPayment() {
  document.getElementById("cart-section").style.display = "none";
  document.getElementById("payment-section").style.display = "block";
}

// COMPLETE PAYMENT
function completePayment() {
  let method = document.querySelector('input[name="pay"]:checked');
  if (!method) {
    alert("Please select a payment method");
    return;
  }

  alert("Payment successful using " + method.value);
}
</script>

</body>
</html>